#!/usr/bin/env python3
"""
Update all CSS templates to use SVG-based brand text instead of font-based text.
This ensures perfect visual consistency between browser and PDF rendering.
"""

import re
from pathlib import Path

# SVG data URI from the conversion script
SVG_DATA_URI = 'data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20standalone%3D%22no%22%3F%3E%0A%3C%21DOCTYPE%20svg%20PUBLIC%20%22-//W3C//DTD%20SVG%2020010904//EN%22%0A%20%22http%3A//www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd%22%3E%0A%3Csvg%20version%3D%221.0%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%0A%20width%3D%221134.000000pt%22%20height%3D%22162.000000pt%22%20viewBox%3D%220%200%201134.000000%20162.000000%22%0A%20preserveAspectRatio%3D%22xMidYMid%20meet%22%3E%0A%3Cmetadata%3E%0ACreated%20by%20potrace%201.10%2C%20written%20by%20Peter%20Selinger%202001-2011%0A%3C/metadata%3E%0A%3Cg%20transform%3D%22translate%280.000000%2C162.000000%29%20scale%280.100000%2C-0.100000%29%22%0Afill%3D%22%23000000%22%20stroke%3D%22none%22%3E%0A%3Cpath%20d%3D%22M845%201443%20c-286%20-53%20-474%20-232%20-535%20-510%20-77%20-348%2093%20-683%20395%20-776%0A62%20-19%20187%20-41%20240%20-41%2054%20-1%20193%2023%20230%2039%2094%2041%20125%2061%20125%2081%200%2019%20-33%20220%0A-45%20271%20-6%2027%20-41%2031%20-83%2010%20-54%20-27%20-137%20-41%20-172%20-28%20-18%206%20-47%2011%20-64%2011%0A-42%200%20-134%2056%20-163%2099%20-32%2047%20-46%20104%20-46%20181%201%2083%2015%20134%2054%20194%2034%2051%2086%2090%0A134%2099%2017%203%2048%2010%2071%2015%2028%206%2056%205%2090%20-4%2027%20-7%2059%20-13%2071%20-14%2012%200%2038%20-8%2058%0A-17%2019%20-9%2038%20-14%2041%20-10%207%207%2013%2035%2040%20206%2015%20101%2015%20105%20-3%20119%20-39%2030%20-112%0A55%20-213%2073%20-121%2021%20-120%2021%20-225%202z%22/%3E%0A%3Cpath%20d%3D%22M2780%201449%20c-14%20-6%20-61%20-15%20-105%20-19%20-44%20-4%20-102%20-14%20-130%20-21%20l-50%0A-14%200%20-510%200%20-510%2026%20-55%20c39%20-82%2074%20-112%20192%20-164%2050%20-21%20222%20-22%20274%20-1%2019%0A8%2044%2015%2054%2015%2010%200%2030%2010%2044%2023%20l26%2022%20-17%20130%20c-17%20134%20-25%20158%20-46%20137%20-7%0A-7%20-33%20-12%20-58%20-12%20-36%200%20-52%205%20-68%2023%20-22%2023%20-22%2027%20-24%20493%20l-3%20469%20-45%202%0Ac-25%201%20-56%20-3%20-70%20-8z%22/%3E%0A%3Cpath%20d%3D%22M4495%201418%20c-3%20-7%20-4%20-296%20-3%20-643%20l3%20-630%20189%20-3%20c104%20-1%20194%202%20198%0A6%205%205%209%20122%208%20259%200%20216%202%20252%2015%20263%2019%2016%2026%2010%2061%20-55%2086%20-162%20118%20-221%0A127%20-233%207%20-9%2035%20-12%2095%20-10%20l84%203%2022%2040%20c13%2022%2047%2085%2076%20140%2029%2055%2057%20106%2063%0A113%2027%2034%2032%201%2037%20-259%20l5%20-264%20200%200%20200%200%200%20640%200%20640%20-195%203%20-196%202%20-138%0A-272%20c-76%20-150%20-142%20-277%20-147%20-283%20-17%20-18%20-47%2029%20-174%20280%20-70%20138%20-132%20256%0A-138%20263%20-7%209%20-59%2012%20-199%2012%20-142%200%20-190%20-3%20-193%20-12z%22/%3E%0A%3Cpath%20d%3D%22M8130%201235%20c-45%20-74%20-90%20-139%20-100%20-145%20-10%20-5%20-41%20-10%20-67%20-10%20-27%0A0%20-54%20-5%20-61%20-12%20-7%20-7%20-12%20-34%20-12%20-60%200%20-26%20-4%20-48%20-10%20-48%20-10%200%20-13%2011%0A-28%2090%20l-8%2045%20-44%20-1%20c-60%20-1%20-116%20-24%20-168%20-69%20-50%20-43%20-77%20-43%20-78%200%200%2017%0A-1%2036%20-2%2043%20-2%209%20-49%2012%20-197%2012%20-194%200%20-195%200%20-200%20-22%20-3%20-13%20-4%20-223%20-3%0A-468%20l3%20-445%20200%200%20200%200%205%20240%20c5%20253%207%20260%2057%20306%2045%2043%2067%2049%20165%2049%2051%200%0A98%204%20104%208%205%204%2010%2023%2010%2042%20-1%2034%200%2035%2039%2038%2071%204%2069%208%2075%20-235%205%20-199%208%20-223%0A28%20-269%2035%20-77%2086%20-121%20195%20-168%2056%20-24%20210%20-22%20297%205%20104%2031%20104%2031%2085%20185%0A-16%20132%20-25%20158%20-47%20136%20-7%20-7%20-33%20-12%20-58%20-12%20-36%200%20-52%205%20-68%2023%20-21%2022%20-22%0A33%20-22%20170%200%20106%203%20148%2013%20154%206%204%2053%2010%20102%2013%20l90%205%203%20100%20c4%20150%208%20145%20-91%0A145%20-51%200%20-90%205%20-100%2013%20-14%2010%20-17%2034%20-19%20142%20l-3%20130%20-102%203%20-101%203%20-82%0A-136z%22/%3E%0A%3Cpath%20d%3D%22M1705%201083%20c-197%20-61%20-301%20-152%20-355%20-313%20-24%20-71%20-29%20-193%20-11%20-273%0A35%20-154%20169%20-286%20341%20-337%2060%20-18%20290%20-18%20350%200%20131%2038%20257%20137%20310%20240%2079%0A155%2061%20364%20-45%20505%20-44%2058%20-140%20135%20-168%20135%20-7%200%20-17%204%20-23%2010%20-5%205%20-43%2019%0A-84%2030%20-92%2024%20-241%2025%20-315%203z%20m223%20-307%20c45%20-23%2072%20-70%2078%20-135%2012%20-108%20-52%0A-191%20-145%20-191%20-90%200%20-151%2068%20-151%20170%200%2051%2027%20120%2052%20137%2050%2032%20125%2040%20166%0A19z%22/%3E%0A%3Cpath%20d%3D%22M3500%201085%20c-19%20-7%20-43%20-14%20-53%20-14%20-44%20-2%20-150%20-67%20-206%20-127%20-88%0A-94%20-131%20-198%20-131%20-317%200%20-140%2055%20-275%20144%20-353%2056%20-48%20159%20-104%20193%20-104%2013%0A0%2040%20-7%2061%20-16%2031%20-12%2069%20-14%20183%20-11%20139%204%20205%2014%20261%2043%2014%208%2033%2014%2041%2014%208%0A0%2017%206%2019%2013%204%2010%20-17%20138%20-38%20235%20-5%2027%20-40%2030%20-85%206%20-22%20-11%20-63%20-16%20-142%0A-17%20-102%20-2%20-115%200%20-149%2021%20-37%2023%20-52%2061%20-25%2063%2076%204%20232%2020%20267%2028%2025%206%2075%0A10%20111%2011%2097%200%20103%208%2096%20116%20-6%2097%20-30%20177%20-72%20245%20-47%2075%20-98%20113%20-215%20159%0A-49%2019%20-216%2023%20-260%205z%20m212%20-272%20c25%20-22%2023%20-30%20-13%20-49%20-27%20-14%20-72%20-24%0A-164%20-36%20-12%20-2%20-21%204%20-23%2015%20-5%2024%2042%2084%2070%2090%2039%209%20111%20-2%20130%20-20z%22/%3E%0A%3Cpath%20d%3D%22M6365%201083%20c-132%20-41%20-180%20-67%20-243%20-130%20-109%20-108%20-156%20-249%20-134%0A-403%2015%20-103%2050%20-176%20122%20-253%2059%20-63%20137%20-110%20230%20-137%2060%20-18%20290%20-18%20350%0A-1%20122%2037%20217%20105%20285%20206%2092%20139%2092%20353%200%20511%20-49%2084%20-173%20169%20-295%20204%20-71%0A20%20-256%2022%20-315%203z%20m243%20-328%20c84%20-75%2082%20-203%20-5%20-274%20-29%20-24%20-47%20-31%20-81%0A-31%20-76%200%20-125%2039%20-148%20117%20-14%2048%20-14%2058%200%20106%2023%2078%2071%20113%20158%20116%2030%201%2046%0A-6%2076%20-34z%22/%3E%0A%3Cpath%20d%3D%22M9036%201079%20c-37%20-10%20-73%20-22%20-80%20-27%20-6%20-5%20-23%20-12%20-39%20-16%20-42%20-10%0A-160%20-127%20-194%20-193%20-43%20-82%20-56%20-149%20-51%20-257%206%20-105%2030%20-173%2090%20-253%2041%20-54%0A137%20-133%20161%20-133%208%200%2020%20-7%2027%20-15%207%20-8%2022%20-15%2034%20-15%2013%200%2043%20-7%2068%20-16%2058%0A-19%20246%20-15%20328%208%20215%2060%20350%20239%20350%20464%200%20278%20-223%20475%20-535%20473%20-54%20-1%0A-117%20-8%20-159%20-20z%20m244%20-311%20c48%20-33%2070%20-81%2070%20-153%200%20-100%20-59%20-165%20-150%0A-165%20-115%200%20-185%20138%20-130%20258%2033%2074%20143%20105%20210%2060z%22/%3E%0A%3Cpath%20d%3D%22M10412%201080%20c-29%20-11%20-76%20-36%20-103%20-56%20-27%20-20%20-56%20-34%20-64%20-31%20-7%203%0A-15%2023%20-17%2044%20l-3%2038%20-195%200%20-195%200%200%20-465%200%20-465%20180%20-3%20c99%20-1%20190%200%20203%203%0Al22%205%200%20247%20c0%20230%201%20250%2021%20290%2029%2061%2065%2083%20131%2083%2055%200%2075%20-12%20104%20-60%205%20-8%0A11%20-139%2014%20-290%20l5%20-275%20200%200%20200%200%200%20295%20c0%20320%20-5%20357%20-56%20464%20-34%2070%20-49%0A88%20-109%20130%20-68%2047%20-107%2059%20-200%2062%20-64%203%20-98%20-1%20-138%20-16z%22/%3E%0A%3C/g%3E%0A%3C/svg%3E%0A'

# New SVG-based CSS for .brand-text
NEW_BRAND_TEXT_CSS = f"""/* Brand Typography - SVG-based for perfect consistency */
.brand-text {{
    /* Hide text content visually while keeping it for accessibility */
    font-size: 0 !important;
    line-height: 0 !important;
    text-indent: -9999px !important;
    overflow: hidden !important;
    
    /* Display SVG as background */
    background-image: url("{SVG_DATA_URI}");
    background-repeat: no-repeat;
    background-position: left center;
    background-size: contain;
    
    /* Set dimensions based on SVG aspect ratio (1134:162 = 7:1 ratio) */
    width: 140pt; /* Approximately 2 inches */
    height: 20pt; /* Maintains aspect ratio */
    
    /* Position adjustment to match original transform */
    transform: translateY(-5px);
    
    /* Ensure proper display */
    display: inline-block;
    vertical-align: middle;
}}"""

# CSS templates to update (excluding executive.css which is already updated)
templates = [
    'applyr/styles/sensylate.css',
    'applyr/styles/heebo-premium.css', 
    'applyr/styles/professional.css',
    'applyr/styles/minimal.css',
    'applyr/styles/ats.css'
]

def update_brand_text_css(css_file: Path) -> bool:
    """Update .brand-text CSS in a template file"""
    try:
        content = css_file.read_text()
        
        # Pattern to match .brand-text CSS block (including comments and properties)
        brand_text_pattern = r'\/\*[^*]*\*\/\s*\.brand-text\s*\{[^}]*\}'
        
        # More flexible pattern that looks for .brand-text selector and its block
        pattern = r'(\/\*[^*]*Brand Typography[^*]*\*\/\s*)?\.brand-text\s*\{[^}]*\}'
        
        # Find and replace the .brand-text CSS block
        matches = re.findall(pattern, content, re.DOTALL | re.IGNORECASE)
        
        if matches:
            # Replace the first match (should be the main .brand-text definition)
            updated_content = re.sub(pattern, NEW_BRAND_TEXT_CSS, content, count=1, flags=re.DOTALL | re.IGNORECASE)
            
            # Write the updated content back
            css_file.write_text(updated_content)
            print(f'✅ Updated: {css_file.name}')
            return True
        else:
            print(f'⚠️  No .brand-text found in: {css_file.name}')
            return False
            
    except Exception as e:
        print(f'❌ Error updating {css_file.name}: {e}')
        return False

def main():
    """Update all CSS templates with SVG-based brand text"""
    print('🔧 Updating CSS templates with SVG-based brand text...')
    print('=' * 60)
    
    success_count = 0
    total_count = len(templates)
    
    for template_path in templates:
        css_file = Path(template_path)
        if css_file.exists():
            if update_brand_text_css(css_file):
                success_count += 1
        else:
            print(f'❌ File not found: {template_path}')
    
    print('=' * 60)
    print(f'📊 Summary: {success_count}/{total_count} templates updated successfully')
    
    if success_count == total_count:
        print('🎉 All templates updated with SVG-based brand text!')
    else:
        print(f'⚠️  {total_count - success_count} templates had issues')

if __name__ == '__main__':
    main()